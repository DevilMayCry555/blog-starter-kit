import"./vendor-others.11f5dab8.js";import{L as A}from"./Chatdoc.ca12b9eb.js";import{e as w,E as L,H as z,R as N,S as B,D as p,n as F,p as M,o as T}from"./vendor-element-plus.4011bc9f.js";import{y as P,_ as k,F as D}from"./index.5f82e941.js";import{d as E,ak as l,o as n,e as b,R as a,I as o,K as R,H as m,M as h,f as c,P as s,O as d,Q as K,as as H,J as O}from"./vendor-@vue.e467cd49.js";import{A as j}from"./Status.a3113516.js";import"./vendor-highlight.js.5674318b.js";import"./vendor-fortawesome.8c26b529.js";import"./vendor-axios.938e43d7.js";import"./vendor-qrcode.f15bf907.js";import"./application.ea1e2a72.js";import"./vendor-markdown.2cd127bb.js";const q=E({name:"UploadDocument",components:{ElButton:w,ElDialog:L,ElUpload:z,ElIcon:N,UploadFilled:B},data(){return{dialogVisible:!1,fileList:[],learning:!1,uploadUrl:P()+"/api/v1/files/"}},computed:{headers(){return{Authorization:`Bearer ${this.$store.state.token.access}`}},urls(){return this.fileList.map(e=>{var t;return(t=e==null?void 0:e.response)==null?void 0:t.file_url})}},async mounted(){},methods:{onExceed(){p.warning(this.$t("chatdoc.message.uploadDocumentsExceed"))},onError(){p.error(this.$t("chatdoc.message.uploadDocumentsError"))},async onSuccess(){p.success(this.$t("chatdoc.message.uploadDocumentsSuccess")),p.info(this.$t("chatdoc.message.startCreateDocument")),this.learning=!0,this.$store.dispatch("chatdoc/createDocument",{repositoryId:this.$route.params.repositoryId,fileUrl:this.urls[0],fileName:this.fileList[0].name}).then(()=>{p.success(this.$t("chatdoc.message.createDocumentSuccess")),this.dialogVisible=!1,this.$store.dispatch("chatdoc/getDocuments",{repositoryId:this.$route.params.repositoryId}),this.$store.dispatch("chatdoc/getApplication")}).catch(()=>{p.error(this.$t("chatdoc.message.createDocumentError"))}).finally(()=>{this.fileList=[],this.learning=!1})}}}),J={key:1,class:"el-upload__text"},Q={key:2};function G(e,t,_,$,I,C){const v=l("upload-filled"),y=l("el-icon"),r=l("el-upload"),f=l("el-dialog"),g=l("el-button");return n(),b(K,null,[a(f,{modelValue:e.dialogVisible,"onUpdate:modelValue":t[1]||(t[1]=u=>e.dialogVisible=u)},{default:o(()=>[a(r,{"file-list":e.fileList,"onUpdate:fileList":t[0]||(t[0]=u=>e.fileList=u),accept:".docx,.doc,.pdf,.txt,.csv,.enex,.epub,.eml,.html,.htm,.shtml,.md,.odt,.ppt,.pptx,.txt",drag:"",class:R({upload:!0}),name:"file","show-file-list":!0,limit:1,multiple:!1,action:e.uploadUrl,"on-exceed":e.onExceed,"on-error":e.onError,"on-success":e.onSuccess,headers:e.headers},{default:o(()=>[e.learning?h("v-if",!0):(n(),m(y,{key:0,class:"el-icon--upload"},{default:o(()=>[a(v)]),_:1})),e.learning?h("v-if",!0):(n(),b("div",J,[c("p",null,s(e.$t("chatdoc.message.dragOrClickToUpload")),1),c("p",null,s(e.$t("chatdoc.message.supportedFiles")),1)])),e.learning?(n(),b("div",Q,s(e.$t("chatdoc.message.learningDocument")),1)):h("v-if",!0)]),_:1},8,["file-list","action","on-exceed","on-error","on-success","headers"])]),_:1},8,["modelValue"]),a(g,{type:"primary",round:"",onClick:t[2]||(t[2]=u=>e.dialogVisible=!0)},{default:o(()=>[d(s(e.$t("chatdoc.button.uploadDocuments")),1)]),_:1})],64)}var W=k(q,[["render",G],["__scopeId","data-v-4a88fdfb"],["__file","D:/react/Nexior/src/components/chatdoc/UploadDocument.vue"]]);const X=E({name:"ChatdocKnowledge",components:{Layout:A,ElButton:w,ElTable:F,ElTag:M,ApplicationStatus:j,ElTableColumn:T,UploadDocument:W},data(){return{loading:!1,repositoryId:this.$route.params.repositoryId.toString()}},computed:{repository(){var e,t,_;return(_=(t=(e=this.$store.state)==null?void 0:e.chatdoc)==null?void 0:t.repositories)==null?void 0:_.find($=>$.id===this.repositoryId)},documents(){var e;return(e=this.repository)==null?void 0:e.documents},needApply(){return this.$store.state.chatdoc.status.getApplication===D.Success&&!this.application},service(){return this.$store.state.chatdoc.service},application(){return this.$store.state.chatdoc.application},initializing(){return this.$store.state.chatdoc.status.getApplication===D.Request}},async mounted(){console.log("start get documents"),this.loading=!0,this.$store.dispatch("chatdoc/getDocuments",{repositoryId:this.repositoryId}).then(()=>{this.loading=!1}).catch(()=>{this.loading=!1})},methods:{onDelete(e){this.$store.dispatch("chatdoc/deleteDocument",{id:e}).then(()=>{p.success(this.$t("chatdoc.message.deleteDocumentSuccess")),this.$store.dispatch("chatdoc/getDocuments",{repositoryId:this.repositoryId})})},onPreview(e){window.open(e,"_blank")}}}),Y={class:"wrapper"},Z={class:"title"},x={class:"introduction"},ee={class:"status"},te={class:"operations"},oe={class:"documents"};function ae(e,t,_,$,I,C){const v=l("application-status"),y=l("upload-document"),r=l("el-table-column"),f=l("el-tag"),g=l("el-button"),u=l("el-table"),U=l("layout"),V=H("loading");return n(),m(U,null,{chatdoc:o(()=>[c("div",Y,[c("div",Z,s(e.$t("chatdoc.title.manage")),1),c("div",x,s(e.$t("chatdoc.message.introductionForKnowledge")),1),c("div",ee,[a(v,{"show-price":!1,initializing:e.initializing,application:e.application,"need-apply":e.needApply,service:e.service,onRefresh:t[0]||(t[0]=i=>e.$store.dispatch("chatdoc/getApplication"))},null,8,["initializing","application","need-apply","service"])]),c("div",te,[a(y)]),c("div",oe,[O((n(),m(u,{data:e.documents,border:""},{default:o(()=>[a(r,{prop:"id",label:"ID"}),a(r,{prop:"file_name",label:e.$t("chatdoc.field.fileName")},null,8,["label"]),a(r,{label:e.$t("chatdoc.field.fileExtension"),width:"100px"},{default:o(i=>[d(s(i.row.file_name.split(".").pop()),1)]),_:1},8,["label"]),a(r,{label:e.$t("chatdoc.field.createdAt"),width:"200px"},{default:o(i=>[d(s(i.row.created_at?e.$dayjs.format(i.row.created_at):""),1)]),_:1},8,["label"]),a(r,{label:e.$t("chatdoc.field.state"),width:"180px"},{default:o(i=>[i.row.state==="processing"?(n(),m(f,{key:0,type:"info"},{default:o(()=>[d(s(e.$t("chatdoc.field.stateProcessing")),1)]),_:1})):h("v-if",!0),i.row.state==="failed"?(n(),m(f,{key:1,type:"danger"},{default:o(()=>[d(s(e.$t("chatdoc.field.stateFailed")),1)]),_:1})):h("v-if",!0),i.row.state==="completed"?(n(),m(f,{key:2,type:"success"},{default:o(()=>[d(s(e.$t("chatdoc.field.stateCompleted")),1)]),_:1})):h("v-if",!0)]),_:1},8,["label"]),a(r,null,{default:o(i=>[a(g,{type:"primary",round:"",size:"small",onClick:S=>e.onPreview(i.row.file_url)},{default:o(()=>[d(s(e.$t("common.button.preview")),1)]),_:2},1032,["onClick"]),a(g,{type:"danger",round:"",size:"small",onClick:S=>e.onDelete(i.row.id)},{default:o(()=>[d(s(e.$t("common.button.delete")),1)]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[V,e.loading]])])])]),_:1})}var _e=k(X,[["render",ae],["__scopeId","data-v-69ae9518"],["__file","D:/react/Nexior/src/pages/chatdoc/Manage.vue"]]);export{_e as default};
