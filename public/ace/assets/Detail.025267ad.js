import"./vendor-others.11f5dab8.js";import{o as P}from"./order.09a5605b.js";import{_ as D}from"./index.5f82e941.js";import{O as k}from"./order.1bf5c3a2.js";import{Q as Y}from"./vendor-qrcode.f15bf907.js";import{E as j,l as H,m as Q,e as Z,q as x,s as ee,t as ae,u as te,w as re,x as oe}from"./vendor-element-plus.4011bc9f.js";import{d as I,ak as l,o as r,H as c,I as a,R as t,f as m,M as n,P as i,aI as U,aJ as G,e as p,Q as se,O as v,K as F}from"./vendor-@vue.e467cd49.js";import{I as ie}from"./application.ea1e2a72.js";import"./vendor-highlight.js.5674318b.js";import"./vendor-axios.938e43d7.js";import"./vendor-fortawesome.8c26b529.js";const le=I({name:"PayOrderDialog",components:{ElDialog:j,QrCode:Y,ElRow:H,ElCol:Q},props:{modelValue:{type:Object,required:!0},visible:{type:Boolean,required:!1,default:!1}},emits:["hide","update:modelValue"],data(){return{refreshTimer:void 0}},mounted(){this.onRefresh()},unmounted(){this.refreshTimer&&clearTimeout(this.refreshTimer)},methods:{onRefresh(){if(!this.modelValue.id){console.error("id does not exist");return}P.refresh(this.modelValue.id).then(({data:e})=>{e.state!==k.PAID?setTimeout(()=>{this.onRefresh()},2e3):this.$emit("hide"),this.$emit("update:modelValue",e)}).catch(()=>{setTimeout(()=>{this.onRefresh()},2e3)})}}}),de=e=>(U("data-v-875060be"),e=e(),G(),e),ne={class:"paycode wechat"},pe={class:"help-text"},ue=de(()=>m("div",{class:"help-img"},[m("img",{src:"https://midas.gtimg.cn/enterprise/images/ep_sys_wx_tip.jpg"})],-1));function ye(e,o,C,E,T,O){const u=l("qr-code"),f=l("el-col"),W=l("el-row"),V=l("el-dialog");return r(),c(V,{"model-value":e.visible,title:e.$t("application.title.buyService"),width:"500px",center:""},{default:a(()=>[t(W,{class:"paycodes"},{default:a(()=>[t(f,{span:12},{default:a(()=>{var h,w;return[m("div",ne,[(h=e.modelValue)!=null&&h.pay_url?(r(),c(u,{key:0,value:(w=e.modelValue)==null?void 0:w.pay_url,size:200,class:"qrcode m-auto"},null,8,["value"])):n("v-if",!0),m("p",pe,i(e.$t("order.message.wechatPayHelp")),1)])]}),_:1}),t(f,{span:12},{default:a(()=>[ue]),_:1})]),_:1})]),_:1},8,["model-value","title"])}var ce=D(le,[["render",ye],["__scopeId","data-v-875060be"],["__file","D:/react/Nexior/src/components/order/WechatPay.vue"]]);const me=I({name:"PayOrderDialog",components:{ElDialog:j},props:{modelValue:{type:Object,required:!0},visible:{type:Boolean,required:!1,default:!1}},emits:["hide","update:modelValue"],data(){return{refreshTimer:void 0}},watch:{visible:{handler(e){e&&this.modelValue.pay_url&&window.open(this.modelValue.pay_url,"_blank")}}},mounted(){this.onRefresh()},unmounted(){this.refreshTimer&&clearTimeout(this.refreshTimer)},methods:{onRefresh(){if(!this.modelValue.id){console.error("id does not exist");return}P.refresh(this.modelValue.id).then(({data:e})=>{e.state!==k.PAID?setTimeout(()=>{this.onRefresh()},2e3):this.$emit("hide"),this.$emit("update:modelValue",e)}).catch(()=>{setTimeout(()=>{this.onRefresh()},5e3)})}}}),fe={class:"text-center"};function he(e,o,C,E,T,O){const u=l("el-dialog");return r(),c(u,{"model-value":e.visible,title:e.$t("application.title.buyService"),width:"500px",center:""},{default:a(()=>[m("p",fe,i(e.$t("order.message.buyInExternalUrl")),1)]),_:1},8,["model-value","title"])}var _e=D(me,[["render",he],["__scopeId","data-v-85959ecc"],["__file","D:/react/Nexior/src/components/order/StripePay.vue"]]);var J=(e=>(e.WechatPay="WechatPay",e.Stripe="Stripe",e.AliPay="AliPay",e))(J||{});const ve=I({name:"ConsoleOrderDetail",components:{ElButton:Z,ElRow:H,ElCard:x,ElCol:Q,ElSkeleton:ee,ElDivider:ae,ElAlert:te,ElDescriptions:re,ElDescriptionsItem:oe,WechatPayOrder:ce,StripePayOrder:_e},data(){return{PayWay:J,payWay:"WechatPay",OrderState:k,order:void 0,loading:!1,paying:!1,prepaying:!1,applicationType:ie}},computed:{id(){var e,o;return(o=(e=this.$route.params)==null?void 0:e.id)==null?void 0:o.toString()},redirect(){var e;return(e=this.$route.query)==null?void 0:e.redirect}},watch:{order:{handler(e){if((e==null?void 0:e.state)===k.PAID){setTimeout(()=>{var o;this.redirect&&window.location.replace((o=this.redirect)==null?void 0:o.toString())},2e3);return}},deep:!0}},mounted(){this.onFetchData()},methods:{onFetchData(){this.loading=!0,P.refresh(this.id).then(({data:e})=>{this.order=e,e.pay_way&&(this.payWay=e.pay_way),this.loading=!1}).catch(()=>{this.loading=!1})},onRepay(){this.paying=!0},onPay(){this.prepaying=!0,P.pay(this.id,{pay_way:this.payWay}).then(({data:e})=>{this.prepaying=!1,this.order=e,this.order.price&&this.order.price>0&&(this.paying=!0)}).catch(()=>{this.prepaying=!1})}}}),K=e=>(U("data-v-2d1dc98e"),e=e(),G(),e),$e={class:"title"},be={key:0,class:"pt-5"},ge={key:1,class:"order"},we={key:0},Pe={key:1},ke={key:0,class:"price unfree"},We={key:1,class:"price free"},Ve={key:0,class:"payways mb-6"},Se=K(()=>m("span",{class:"payicon wechatpay"},null,-1)),De={class:"payname"};const Ie=K(()=>m("span",{class:"payicon stripe"},null,-1)),Ce={class:"payname"},Ee={key:1},Te={key:2};function Oe(e,o,C,E,T,O){const u=l("el-col"),f=l("el-row"),W=l("el-skeleton"),V=l("copy-to-clipboard"),h=l("el-descriptions-item"),w=l("el-descriptions"),S=l("el-divider"),R=l("el-alert"),A=l("el-button"),L=l("el-card"),M=l("wechat-pay-order"),X=l("stripe-pay-order");return r(),p(se,null,[t(f,{class:"panel"},{default:a(()=>[t(u,{span:24},{default:a(()=>[t(f,null,{default:a(()=>[t(u,{span:24},{default:a(()=>[m("h2",$e,i(e.$t("order.title.info")),1)]),_:1})]),_:1}),t(f,null,{default:a(()=>[t(u,{span:24},{default:a(()=>[t(L,{shadow:"hover"},{default:a(()=>{var _,N,B,q;return[t(f,null,{default:a(()=>[t(u,{span:14,offset:5},{default:a(()=>[e.loading?(r(),p("div",be,[t(W,{animated:""})])):(r(),p("div",ge,[t(w,{column:1},{default:a(()=>{var $,b,z;return[t(h,{label:e.$t("order.field.id")},{default:a(()=>{var s,d,y;return[m("span",null,i((s=e.order)==null?void 0:s.id),1),(d=e.order)!=null&&d.id?(r(),c(V,{key:0,content:(y=e.order)==null?void 0:y.id,class:"inline-block"},null,8,["content"])):n("v-if",!0)]}),_:1},8,["label"]),t(h,{label:e.$t("order.field.description")},{default:a(()=>{var s;return[v(i((s=e.order)==null?void 0:s.description),1)]}),_:1},8,["label"]),(b=($=e.order)==null?void 0:$.application)!=null&&b.service?(r(),c(h,{key:0,label:e.$t("order.field.api")},{default:a(()=>{var s,d,y;return[v(i((y=(d=(s=e.order)==null?void 0:s.application)==null?void 0:d.service)==null?void 0:y.title),1)]}),_:1},8,["label"])):n("v-if",!0),(z=e.order)!=null&&z.pay_way?(r(),c(h,{key:1,label:e.$t("order.field.payWay")},{default:a(()=>{var s,d;return[((s=e.order)==null?void 0:s.pay_way)===e.PayWay.WechatPay?(r(),p("span",we,i(e.$t("order.title.wechatPay")),1)):n("v-if",!0),((d=e.order)==null?void 0:d.pay_way)===e.PayWay.Stripe?(r(),p("span",Pe,i(e.$t("order.title.stripe")),1)):n("v-if",!0)]}),_:1},8,["label"])):n("v-if",!0),t(h,{label:e.$t("order.field.amount")},{default:a(()=>{var s,d,y,g;return[v(i((s=e.order)==null?void 0:s.amount)+" "+i(e.$t(`service.unit.${(g=(y=(d=e.order)==null?void 0:d.application)==null?void 0:y.service)==null?void 0:g.unit}`)),1)]}),_:1},8,["label"]),t(h,{label:e.$t("order.field.createdAt")},{default:a(()=>{var s;return[v(i(e.$dayjs.format((s=e.order)==null?void 0:s.created_at)),1)]}),_:1},8,["label"]),t(h,{label:e.$t("order.field.price")},{default:a(()=>{var s,d,y,g;return[((s=e.order)==null?void 0:s.price)&&((d=e.order)==null?void 0:d.price)>0?(r(),p("span",ke," $"+i((g=(y=e.order)==null?void 0:y.price)==null?void 0:g.toFixed(2)),1)):(r(),p("span",We,i(e.$t("order.message.free")),1))]}),_:1},8,["label"])]}),_:1})]))]),_:1})]),_:1}),((_=e.order)==null?void 0:_.state)===e.OrderState.PAID?(r(),c(f,{key:0,class:"mb-5"},{default:a(()=>[t(u,{span:14,offset:5},{default:a(()=>[t(S,{"border-style":"dashed"}),t(R,{title:e.$t("order.message.paidSuccessfully"),type:"success","show-icon":"",closable:!1},null,8,["title"])]),_:1})]),_:1})):n("v-if",!0),((N=e.order)==null?void 0:N.state)===e.OrderState.EXPIRED?(r(),c(f,{key:1,class:"mb-5"},{default:a(()=>[t(u,{span:14,offset:5},{default:a(()=>[t(S,{"border-style":"dashed"}),t(R,{title:e.$t("order.message.orderExpired"),type:"error","show-icon":"",closable:!1},null,8,["title"])]),_:1})]),_:1})):n("v-if",!0),((B=e.order)==null?void 0:B.state)===e.OrderState.PENDING||((q=e.order)==null?void 0:q.state)===e.OrderState.FAILED?(r(),c(f,{key:2},{default:a(()=>[t(u,{span:14,offset:5},{default:a(()=>{var $;return[t(S,{"border-style":"dashed"}),e.order.price&&e.order.price>0&&!e.order.pay_way?(r(),p("div",Ve,[(r(),p("div",{key:0,class:F({payway:!0,wechatpay:!0,active:e.payWay===e.PayWay.WechatPay}),onClick:o[0]||(o[0]=b=>e.payWay=e.PayWay.WechatPay)},[Se,m("span",De,i(e.$t("order.title.wechatPay")),1)],2)),n("v-if",!0),(r(),p("div",{key:2,class:F({payway:!0,stripe:!0,active:e.payWay===e.PayWay.Stripe}),onClick:o[2]||(o[2]=b=>e.payWay=e.PayWay.Stripe)},[Ie,m("span",Ce,i(e.$t("order.title.stripe")),1)],2))])):n("v-if",!0),($=e.order)!=null&&$.pay_way?(r(),p("div",Te,[t(A,{type:"primary",round:"",size:"large",class:"btn-repay",onClick:e.onRepay},{default:a(()=>[v(i(e.$t("common.button.repay")),1)]),_:1},8,["onClick"])])):(r(),p("div",Ee,[t(A,{loading:e.prepaying,round:"",type:"primary",size:"large",class:"btn-pay",onClick:e.onPay},{default:a(()=>[v(i(e.$t("common.button.pay")),1)]),_:1},8,["loading","onClick"])]))]}),_:1})]),_:1})):n("v-if",!0)]}),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e.order&&e.payWay===e.PayWay.WechatPay?(r(),c(M,{key:0,modelValue:e.order,"onUpdate:modelValue":o[3]||(o[3]=_=>e.order=_),visible:e.paying,onHide:o[4]||(o[4]=_=>e.paying=!1)},null,8,["modelValue","visible"])):n("v-if",!0),e.order&&e.payWay===e.PayWay.Stripe?(r(),c(X,{key:1,modelValue:e.order,"onUpdate:modelValue":o[5]||(o[5]=_=>e.order=_),visible:e.paying,onHide:o[6]||(o[6]=_=>e.paying=!1)},null,8,["modelValue","visible"])):n("v-if",!0)],64)}var Ge=D(ve,[["render",Oe],["__scopeId","data-v-2d1dc98e"],["__file","D:/react/Nexior/src/pages/console/order/Detail.vue"]]);export{Ge as default};
